<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensor Data Visualization</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container data-page">
        <h1>Sensor Data Graph</h1>
        <canvas id="sensorChart"></canvas>
        <button class="refresh-button" onclick="fetchSensorData()">Refresh Data</button>
    </div>

    <script>
        async function fetchSensorData() {
            try {
                const response = await fetch('/get-sensor-data');
                const data = await response.json();
                updateChart(data);
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        function updateChart(sensorData) {
            const labels = sensorData.map(entry => entry.time_stamp);
            const tempData = sensorData.map(entry => entry.dht22_temp);
            const humData = sensorData.map(entry => entry.dht22_hum);
            const lm35Data = sensorData.map(entry => entry.lm35);

            const ctx = document.getElementById('sensorChart').getContext('2d');
            if (window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'DHT22 Temperature',
                            data: tempData,
                            borderColor: '#ff6347',
                            borderWidth: 2,
                            fill: false
                        },
                        {
                            label: 'DHT22 Humidity',
                            data: humData,
                            borderColor: '#1e90ff',
                            borderWidth: 2,
                            fill: false
                        },
                        {
                            label: 'LM35 Temperature',
                            data: lm35Data,
                            borderColor: '#32cd32',
                            borderWidth: 2,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Timestamp'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Value'
                            }
                        }
                    }
                }
            });
        }

        fetchSensorData();  // Load data on page load
    </script>
</body>
</html>
